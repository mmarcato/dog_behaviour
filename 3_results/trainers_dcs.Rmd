---
title: "Trainers Ethogram - DC1 & DC2 "
author: "Marinara Marcato"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "C:/Users/marinara.marcato/Project/Scripts/dog_ethogram")
knitr::opts_chunk$set(echo = TRUE)
#install.packages("ggpubr")
library(DescTools)
library(ggplot2)
library(dplyr)
library(plyr)

# not sure if necessary
library(tidyverse)
library(rstatix)
library(ggpubr)
```

## Introduction 
This document shows the data analysis carried out to investigate 
dog's behavioral data considering the ethograms filled out by trainers
two trainers.


## Data Exploration
### Columns: Variables
The ethogram comprised of the following types and number of variables.

```{r, echo = FALSE}
dcs <- read.csv('0_data//2_analysis//2021-05-03_Ethogram-Trainers-DCS.csv', stringsAsFactors=FALSE)
vars <- read.csv('0_data//0_raw//ethogram-variables-trainers.csv', stringsAsFactors=FALSE)

# print the number of variables per data type
print(table(vars$Type))

# Adding a column to df vars for Test 
vars = vars %>% mutate(Test = case_when(
        Type == "count" ~ "Wilcoxon",
        Type == "ordinal" ~ "Wilcoxon", 
        Type == "categorical" ~ "Chisq"))
```


### Rows: Dogs
Total number of dogs with DC1 and DC2:
```{r, echo = FALSE}
print(length(unique(dcs[dcs$Data.Collection.Number ==1, 'Name'])))
print(length(unique(dcs[dcs$Data.Collection.Number ==2, 'Name'])))
```

## Data Analysis
Hypothesis testing: investigate difference in behaviour between DC1 and DC2 for the same dog, considering all behavioural variables. 
The following statistical tests were performed considering the variable type  <br>
Wilcoxon -> Ordinal = 53 variables in total<br>
Chiqs -> Categorical = 17 variables in total<br>

```{r echo = FALSE}
cat('Count\n', paste(vars[vars$Type == 'count', 'Variable'], collapse = ','))
cat('Ordinal\n', paste(vars[vars$Type == 'ordinal', 'Variable'], collapse = ','))
cat('Categorical', paste(vars[vars$Type == 'categorical', 'Variable'], collapse = ','))
```

```{r, include = FALSE}
stats <- function(test, var){
    print(var)
    if (!is.na(test)){
        if (test == 'Wilcoxon'){
            cat('wilcoxon\n\n')
            print(var)
            r = wilcox.test(dcs[dcs$Data.Collection.Number == 1 , var],  dcs[dcs$Data.Collection.Number == 2, var], paired = TRUE)
            return(r$p.value)
        } else if (test == 'Chisq'){  
            dc1 = dcs[dcs$Data.Collection.Number == 1 , as.character(var)]
            dc2 = dcs[dcs$Data.Collection.Number == 2, as.character(var)]
            #cat(dc1,"\n", dc2,"\n")
            #cat(unique(dc1),"\n", unique(dc2),"\n")
            if ((unique(dc1) == unique(dc2)) & (length(unique(dc1))>1) & (length(unique(dc2))>1)){
                r = chisq.test(dc1, dc2)
                return(r$p.value)
        }
        }
        return(NA)
    }
    return(NA)
}
vars = vars %>% mutate(Result = mapply(FUN = stats, test = vars$Test, var = vars$Variable))
vars$Result = as.numeric(vars$Result)
```

## Results
Results are saved in a file (trainers_dcs.csv). Below are variable with statistically significant results. <br>
It means that dogs showed a statistically different behaviour taking DC1 at Week 3 and DC2 Week 10. 
```{r, echo = FALSE}
vars$Sign = ifelse(vars$Result<0.05, 1, 0)
unique(vars[vars$Sign == 1, 'Variable'])
write.csv(vars, "0_data//3_results//trainers_dcs.csv")


```



