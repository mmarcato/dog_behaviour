---
title: "Researchers Ethogram - DC1 & DC2"
author: "Marinara Marcato"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "C:/Users/marinara.marcato/Project/Scripts/dog_ethogram")
knitr::opts_chunk$set(echo = TRUE)
#install.packages("ggpubr")
library(DescTools)
library(ggplot2)
library(dplyr)
library(plyr)
library(tidyverse)
library(rstatix)
library(ggpubr)
```

## Introduction 
This document shows the data analysis carried out to investigate 
dog's behavioral data considering the ethograms filled out by students
Hazel and Conghal!

## Data Exploration
### Columns: Variables
The ethogram comprised of the following types and number of variables.
```{r, echo = FALSE}
dcs <- read.csv('0_data//2_analysis//2021-05-03_Ethogram-Researchers-DCS.csv', stringsAsFactors=FALSE)
vars <- read.csv('0_data//0_raw//ethogram-variables-researchers.csv', stringsAsFactors=FALSE)

# importing the data dataset to make sure that I found all the ethograms
# 48 dog have DC2 video scored, but 2 of those don't have their DC1 video scored
data <- read.csv('0_data//0_raw//Data Collection - Data.csv',  stringsAsFactors=FALSE, skip = 1 )


# print the number of variables per data type
print(table(vars$Type))
# Adding a column to df vars for Test 

#### DOUBLE CHECK WHY PAYS (CHISQ) TEST RESULT IS NA
vars = vars %>% mutate(Test = case_when(
        Type == "count" ~ "Wilcoxon",
        Type == "ordinal" ~ "Wilcoxon", 
        Type == "categorical" ~ "Chisq"))
```
### Rows: Dogs
Number of dogs with DC1 and DC2:
```{r, echo = FALSE}
setdiff(unique(data[data$Researcher.Ethogram.1 =='Done', 'Name']),unique(dcs$Name) )
print(length(unique(dcs$Name)))
```

## Data Analysis
Hypothesis testing: investigate difference in behaviour between DC1 and DC2 for the same dog, considering all behavioural variables. 
The following statistical tests were performed considering the variable type  <br>
Wilcoxon -> Count, Ordinal = 41 variables in total<br>
Chiqs -> Categorical = 14 variables in total<br>

```{r echo = FALSE}
cat('Count\n', paste(vars[vars$Type == 'count', 'Variable'], collapse = ','))
cat('Ordinal\n', paste(vars[vars$Type == 'ordinal', 'Variable'], collapse = ','))
cat('Categorical', paste(vars[vars$Type == 'categorical', 'Variable'], collapse = ','))
```
```{r include = FALSE}

stats <- function(test, var){
  if (!is.na(test)){
    if (test == 'Wilcoxon'){
        print(var)
        r = wilcox.test(dcs[dcs$Data.Collection.Number == 1 , var],  dcs[dcs$Data.Collection.Number == 2, var], paired = TRUE)
        return(r$p.value)
    } else if (test == 'Chisq'){
      dc1 = dcs[dcs$Data.Collection.Number == 1 , as.character(var)]
      dc2 = dcs[dcs$Data.Collection.Number == 2, as.character(var)]
      #cat(dc1,"\n", dc2,"\n")
      #cat(unique(dc1),"\n", unique(dc2),"\n")
      if ((unique(dc1) == unique(dc2)) & (length(unique(dc1))>1) & (length(unique(dc2))>1)){
        r = chisq.test(dc1, dc2)
        return(r$p.value)
      }
    }
    return(NA)
  }
  return(NA)
}

vars = vars %>% mutate(Result = mapply(FUN = stats, test = vars$Test, var = vars$Variable))
vars$Result = as.numeric(vars$Result)
```
## Results
Results are saved in a file (researcher_dcs.csv). Below are variable with statistically significant results. <br>
It means that dogs showed a statistically different behaviour taking DC1 at Week 3 and DC2 Week 10. 
```{r, echo = FALSE}
vars$Sign = ifelse(vars$Result<0.05, 1, 0)
unique(vars[vars$Sign == 1, 'Variable'])
write.csv(vars,"0_data//3_results//researchers_dcs.csv")
```