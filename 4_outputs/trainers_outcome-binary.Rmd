---
title: "Trainers Ethogram - Outcome (GD, AD, W) - Post-Hoc"
author: "Marinara Marcato"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = "C:/Users/marinara.marcato/Project/Scripts/dog_ethogram")
knitr::opts_chunk$set(echo = TRUE)
#install.packages("ggpubr")
library(DescTools)
library(ggplot2)
library(dplyr)
library(plyr)
library(tidyverse)
library(rstatix)
library(ggpubr)
```

## Introduction 
I think I was doing this to investigate which groups were different when 

IMPORTANT: 
The outcome of the Kruskal–Wallis test tells you if there are differences among the groups, but doesn’t tell you which groups are different from other groups.  In order to determine which groups are different from others, post-hoc testing can be conducted.  Probably the most common post-hoc test for the Kruskal–Wallis test is the Dunn test, here conducted with the dunnTest function in the FSA package.
This document shows the data analysis carried out to investigate 
dog's behavioral data considering the ethograms filled out by two trainers.


## Data Exploration
### Columns: Variables
The ethogram comprised of the following types and number of variables.

```{r, echo = FALSE}
dc1 <- read.csv('0_data//2_analysis//2021-06-08_Ethogram-Trainers-DC1.csv', stringsAsFactors=FALSE)
dc2 <- read.csv('0_data//2_analysis//2021-06-08_Ethogram-Trainers-DC2.csv', stringsAsFactors=FALSE)

vars <- read.csv('0_data//3_results//trainers_outcome.csv', stringsAsFactors=FALSE)

dc1 <- dc1 %>% mutate( Label = case_when( Status == 'AD' ~ "Success",
                                    Status == 'GD' ~ "Success",
                                    Status == 'W' ~ "Fail"))

dc2 <- dc2 %>% mutate( Label = case_when( Status == 'AD' ~ "Success",
                                    Status == 'GD' ~ "Success",
                                    Status == 'W' ~ "Fail"))
```


### Rows: Dogs
Total number of dogs with DC1 and DC2:
```{r, echo = FALSE}
## dogs with dc1
cat('Dogs with DC1: ', length(dc1$Name))
# removing dogs in Training
dc1_outcome = dc1 %>% filter( Status != 'in Training' )
# printing out information
cat("DC1 & Outcome:", length(dc1_outcome$Name)) # "\n" paste(sort(dc1_outcome$Name), collapse = ", "))

## dogs with dc2 
cat('Dogs with DC2: ', length(dc2$Name))
# removing dogs in Training
dc2_outcome = dc2 %>% filter( Status != 'in Training' )
# printing out information
cat("DC2 & Outcome:", length(dc2_outcome$Name)) # "\n", paste(sort(dc2_outcome$Name), collapse = ", "))
```

## Data Analysis: Post-Hoc
TBD THIS IS NOT WORKING YET!


Testing significance of all ORDINAL variables considering Training Outcome as grouping factor.
It saves results for significantly different behaviours between litters for each dc.
```{r, eval  = FALSE, echo = FALSE}
# ordinal_between_groups <- function(var, data, group){
#     print(var)
#     print(group)
#     print(length(data[,var]))
#     print(length(data[, group]))
#     r = kruskal.test(df[, var], df[,group])
#     result = c(r[1], r[2], r[3])
#     return (result)
# }
# vars_dc1_ordinal =  vars %>% filter(Type == 'ordinal')  %>% pull('Variable') 

# vars = vars %>% 
#         # filtering ordinal variables with sign. dc1 differences
#         filter( dc1_sign == 1 , Type == 'ordinal' ) %>% 
#         # testing which categories showed different results
#         mutate(dc1_outcome = mapply(FUN = ordinal_between_groups,
#          var = vars_dc1_ordinal, MoreArgs = list(dc1_outcome, 'Label')))

#dc1_ordinal = count_between_groups(dc1_outcome)
#v_ft = vars %>% filter( dc1_sign == 1 , Type == 'ordinal' ) %>% pull('Variable')
```

## Outputs: Statistically Significant Variables

### DC1
Below are the variables that showed statistically significant differences in behaviours at DC1 considering between different Training Outcomes ('Success', 'Fail').
```{r, echo  = FALSE}
vars_dc1 =  vars %>% filter( dc1_sign == 1 ) %>% pull('Variable')
print(vars_dc1)

plotseries <- function(var){
    ggplot(dc1_outcome, aes_string(x = var, fill = 'Label')) + 
            geom_bar(position = "dodge")}
lapply(vars_dc1, plotseries )
```

### DC2
Below are the variables that showed statistically significant differences in behaviours at DC2 considering different Training Outcomes  ('Success', 'Fail').

```{r,echo = FALSE}
vars_dc2 =  vars %>% filter( dc2_sign == 1 ) %>% pull('Variable')
print(vars_dc2)
plotseries <- function(var){
    ggplot(dc2_outcome, aes_string( x = var, fill = 'Label')) + 
            geom_bar(position = "dodge")}
lapply(vars_dc2, plotseries )
```
