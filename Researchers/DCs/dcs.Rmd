---
title: "Student Ethogram - Data Analysis"
author: "Marinara Marcato"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#install.packages("ggpubr")
library(DescTools)
library(ggplot2)
library(dplyr)
library(plyr)
library(tidyverse)
library(rstatix)
library(ggpubr)
```

## Introduction 
This document shows the data analysis carried out to investigate 
dog's behavioral data considering the ethograms filled out by students
Hazel and Conghal!

## Data Exploration
### Columns: Variables
The ethogram comprised of the following types and number of variables.
```{r, echo = FALSE}
setwd("C://Users//marinara.marcato//Data//Ethogram//Researchers")
dcs <- read.csv('dcs.csv', stringsAsFactors=FALSE)
vars <- read.csv(file = 'variables.csv', stringsAsFactors=FALSE)

# Adding a column to df vars for Test 
vars = vars %>% mutate(Test = case_when(
        Type == "count" ~ "Wilcoxon",
        Type == "ordinal" ~ "Wilcoxon", 
        Type == "categorical" ~ "Chisq"))
# print the number of variables per data type
print(table(vars$Type))
```
### Rows: Dogs
Number of dogs with DC1 and DC2:
```{r, echo = FALSE}
print(length(unique(dcs$Name)))
```


Performs statistical tests. Wilcoxon and Chisq:
```{r, echo = FALSE}
stats <- function(test, var){
  if (!is.na(test)){
    if (test == 'Wilcoxon'){
        r = wilcox.test(dcs[dcs$Data.Collection.Number == 1 , var],  dcs[dcs$Data.Collection.Number == 2, var], paired = TRUE)
        return(r$p.value)
    } else if (test == 'Chisq'){
      dc1 = dcs[dcs$Data.Collection.Number == 1 , as.character(var)]
      dc2 = dcs[dcs$Data.Collection.Number == 2, as.character(var)]
      #cat(dc1,"\n", dc2,"\n")
      #cat(unique(dc1),"\n", unique(dc2),"\n")
      if ((unique(dc1) == unique(dc2)) & (length(unique(dc1))>1) & (length(unique(dc2))>1)){
        r = chisq.test(dc1, dc2)
        return(r$p.value)
      }
    }
    return(NA)
  }
  return(NA)
}

vars = vars %>% mutate(Result = mapply(FUN = stats, test = vars$Test, var = vars$Variable))
vars$Result = as.numeric(vars$Result)
vars$Sign = ifelse(vars$Result<0.05, 1, 0)
unique(vars[vars$Sign == 1, 'Variable'])
write.csv(vars,"Results_dcs.csv")
```

